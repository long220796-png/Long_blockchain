{"ast":null,"code":"const handleDonate = async () => {\n  if (!wallet) {\n    alert(\"Please connect MetaMask first\");\n    return;\n  }\n  if (!amount || isNaN(amount) || Number(amount) <= 0) {\n    alert(\"Please enter a valid amount\");\n    return;\n  }\n  if (!donorName.trim()) {\n    alert(\"Vui lòng nhập tên người quyên góp\");\n    return;\n  }\n  if (!projectName.trim()) {\n    alert(\"Vui lòng nhập tên dự án quyên góp\");\n    return;\n  }\n  const memoStr = `Người quyên góp: ${donorName} | Dự án: ${projectName}`;\n  setMemo(memoStr);\n  setLoading(true);\n  try {\n    // Contract address and ABI\n    const CONTRACT_ADDRESS = \"0x9d5f77169ead4C8C96D63993eD9ef6239092c416\";\n    const ABI = [\"function donate(uint256 amount) public\"];\n    const provider = new ethers.BrowserProvider(window.ethereum);\n    const signer = await provider.getSigner();\n    const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);\n    const value = ethers.parseUnits(amount.toString(), 18);\n    // Lưu ý: ERC20 trên Hedera không hỗ trợ truyền memo trực tiếp khi gọi transfer/donate.\n    // Memo này chỉ lưu ở frontend để hiển thị lịch sử giao dịch hoặc báo cáo đồ án.\n    // Nếu muốn lưu memo on-chain, cần sửa smart contract hoặc backend.\n    const tx = await contract.donate(value);\n    await tx.wait();\n\n    // Gửi thông tin lên backend sau khi giao dịch thành công\n    try {\n      await fetch(\"http://localhost:5000/api/donations\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          donorName,\n          projectId: id,\n          projectName,\n          amount,\n          txHash: tx.hash\n        })\n      });\n    } catch (err) {\n      // Có thể log hoặc hiển thị thông báo gửi backend thất bại nếu muốn\n      console.error(\"Lưu lịch sử giao dịch thất bại:\", err);\n    }\n    alert(\"Transaction sent successfully\");\n  } catch (err) {\n    alert((err === null || err === void 0 ? void 0 : err.message) || \"Transaction failed\");\n  } finally {\n    setLoading(false);\n  }\n};","map":{"version":3,"names":["handleDonate","wallet","alert","amount","isNaN","Number","donorName","trim","projectName","memoStr","setMemo","setLoading","CONTRACT_ADDRESS","ABI","provider","ethers","BrowserProvider","window","ethereum","signer","getSigner","contract","Contract","value","parseUnits","toString","tx","donate","wait","fetch","method","headers","body","JSON","stringify","projectId","id","txHash","hash","err","console","error","message"],"sources":["D:/payment/frontend/src/pages/DonateDetail.js"],"sourcesContent":["const handleDonate = async () => {\r\n  if (!wallet) {\r\n    alert(\"Please connect MetaMask first\");\r\n    return;\r\n  }\r\n  if (!amount || isNaN(amount) || Number(amount) <= 0) {\r\n    alert(\"Please enter a valid amount\");\r\n    return;\r\n  }\r\n  if (!donorName.trim()) {\r\n    alert(\"Vui lòng nhập tên người quyên góp\");\r\n    return;\r\n  }\r\n  if (!projectName.trim()) {\r\n    alert(\"Vui lòng nhập tên dự án quyên góp\");\r\n    return;\r\n  }\r\n  const memoStr = `Người quyên góp: ${donorName} | Dự án: ${projectName}`;\r\n  setMemo(memoStr);\r\n  setLoading(true);\r\n  try {\r\n    // Contract address and ABI\r\n    const CONTRACT_ADDRESS = \"0x9d5f77169ead4C8C96D63993eD9ef6239092c416\";\r\n    const ABI = [\r\n      \"function donate(uint256 amount) public\"\r\n    ];\r\n    const provider = new ethers.BrowserProvider(window.ethereum);\r\n    const signer = await provider.getSigner();\r\n    const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);\r\n    const value = ethers.parseUnits(amount.toString(), 18);\r\n    // Lưu ý: ERC20 trên Hedera không hỗ trợ truyền memo trực tiếp khi gọi transfer/donate.\r\n    // Memo này chỉ lưu ở frontend để hiển thị lịch sử giao dịch hoặc báo cáo đồ án.\r\n    // Nếu muốn lưu memo on-chain, cần sửa smart contract hoặc backend.\r\n    const tx = await contract.donate(value);\r\n    await tx.wait();\r\n\r\n    // Gửi thông tin lên backend sau khi giao dịch thành công\r\n    try {\r\n      await fetch(\"http://localhost:5000/api/donations\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          donorName,\r\n          projectId: id,\r\n          projectName,\r\n          amount,\r\n          txHash: tx.hash\r\n        })\r\n      });\r\n    } catch (err) {\r\n      // Có thể log hoặc hiển thị thông báo gửi backend thất bại nếu muốn\r\n      console.error(\"Lưu lịch sử giao dịch thất bại:\", err);\r\n    }\r\n\r\n    alert(\"Transaction sent successfully\");\r\n  } catch (err) {\r\n    alert(err?.message || \"Transaction failed\");\r\n  } finally {\r\n    setLoading(false);\r\n  }\r\n};"],"mappings":"AAAA,MAAMA,YAAY,GAAG,MAAAA,CAAA,KAAY;EAC/B,IAAI,CAACC,MAAM,EAAE;IACXC,KAAK,CAAC,+BAA+B,CAAC;IACtC;EACF;EACA,IAAI,CAACC,MAAM,IAAIC,KAAK,CAACD,MAAM,CAAC,IAAIE,MAAM,CAACF,MAAM,CAAC,IAAI,CAAC,EAAE;IACnDD,KAAK,CAAC,6BAA6B,CAAC;IACpC;EACF;EACA,IAAI,CAACI,SAAS,CAACC,IAAI,CAAC,CAAC,EAAE;IACrBL,KAAK,CAAC,mCAAmC,CAAC;IAC1C;EACF;EACA,IAAI,CAACM,WAAW,CAACD,IAAI,CAAC,CAAC,EAAE;IACvBL,KAAK,CAAC,mCAAmC,CAAC;IAC1C;EACF;EACA,MAAMO,OAAO,GAAG,oBAAoBH,SAAS,aAAaE,WAAW,EAAE;EACvEE,OAAO,CAACD,OAAO,CAAC;EAChBE,UAAU,CAAC,IAAI,CAAC;EAChB,IAAI;IACF;IACA,MAAMC,gBAAgB,GAAG,4CAA4C;IACrE,MAAMC,GAAG,GAAG,CACV,wCAAwC,CACzC;IACD,MAAMC,QAAQ,GAAG,IAAIC,MAAM,CAACC,eAAe,CAACC,MAAM,CAACC,QAAQ,CAAC;IAC5D,MAAMC,MAAM,GAAG,MAAML,QAAQ,CAACM,SAAS,CAAC,CAAC;IACzC,MAAMC,QAAQ,GAAG,IAAIN,MAAM,CAACO,QAAQ,CAACV,gBAAgB,EAAEC,GAAG,EAAEM,MAAM,CAAC;IACnE,MAAMI,KAAK,GAAGR,MAAM,CAACS,UAAU,CAACrB,MAAM,CAACsB,QAAQ,CAAC,CAAC,EAAE,EAAE,CAAC;IACtD;IACA;IACA;IACA,MAAMC,EAAE,GAAG,MAAML,QAAQ,CAACM,MAAM,CAACJ,KAAK,CAAC;IACvC,MAAMG,EAAE,CAACE,IAAI,CAAC,CAAC;;IAEf;IACA,IAAI;MACF,MAAMC,KAAK,CAAC,qCAAqC,EAAE;QACjDC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/CC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnB5B,SAAS;UACT6B,SAAS,EAAEC,EAAE;UACb5B,WAAW;UACXL,MAAM;UACNkC,MAAM,EAAEX,EAAE,CAACY;QACb,CAAC;MACH,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZ;MACAC,OAAO,CAACC,KAAK,CAAC,iCAAiC,EAAEF,GAAG,CAAC;IACvD;IAEArC,KAAK,CAAC,+BAA+B,CAAC;EACxC,CAAC,CAAC,OAAOqC,GAAG,EAAE;IACZrC,KAAK,CAAC,CAAAqC,GAAG,aAAHA,GAAG,uBAAHA,GAAG,CAAEG,OAAO,KAAI,oBAAoB,CAAC;EAC7C,CAAC,SAAS;IACR/B,UAAU,CAAC,KAAK,CAAC;EACnB;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}